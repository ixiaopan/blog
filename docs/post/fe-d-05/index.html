<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<title>D - Things about frames</title>



  
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-203640627-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-203640627-1');
  </script>
  




<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
  rel="alternate"
  type="application/rss+xml"
  href="https://ixiaopan.github.io/blog/index.xml"
  title=""
/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="D - Things about frames"/>
<meta name="twitter:description" content="Speaking of images and videos, we often use img/video to preview them. However, there are more ways to do this. Today we will introduce some new preview techniques based on frames, such as frame-based video preview, drawing continuous frames over a time, and extract any frame of a gif image."/>




<link rel="stylesheet" href="https://ixiaopan.github.io/blog/fontawesome/css/all.min.css" />




<link
  crossorigin="anonymous"
  href="/blog/css/styles.min.css"
  integrity=""
  rel="preload stylesheet"
  as="style"
/>


  <link rel="stylesheet" href="https://ixiaopan.github.io/blog/css/main.css" />



<link
  id="dark-mode-theme"
  crossorigin="anonymous"
  href="/blog/css/dark.min.css"
  integrity=""
  rel="preload stylesheet"
  as="style"
/>


<script>
  var darkTheme = document.getElementById('dark-mode-theme')
  var storedTheme = localStorage.getItem('dark-mode-storage')
  if (storedTheme === 'dark') {
    darkTheme.disabled = false
  } else if (storedTheme === 'light') {
    darkTheme.disabled = true
  }
</script>



<script defer crossorigin="anonymous" src="/blog/js/theme.js" integrity=""></script>

<script src="https://ixiaopan.github.io/blog/js/instantpage.min.js" type="module" defer></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css" integrity="sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.js" integrity="sha384-JiKN5O8x9Hhs/UE5cT5AAJqieYlOZbGT3CHws/y97o3ty4R7/O5poG9F3JoiOYw1" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>

 



<meta name="generator" content="Hugo 0.81.0" />
  </head>
  <body>
    
  




<header>
  <nav class="navbar">
  <div class="nav">
    
      <a href="https://ixiaopan.github.io/blog/" class="nav-logo">
        <img
          src="https://ixiaopan.github.io/blog/images/me.JPG"
          width="50"
          height="50"
          alt="Logo"
        />
      </a>
    

    <ul class="nav-links">
      
        
          <li>
            <a href="/blog/search" id="Search"
              ><em class="fas fa-search fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/blog/about" id="About"
              ><em class="fas fa-user fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/blog/categories" id="Category"
              ><em class="fas fa-folder-open fa-lg"></em
            ></a>
          </li>
          
      
    </ul>
  </div>
</nav>


  
  <div class="intro-header">
    <h1 class="post-heading">
      D - Things about frames
    </h1>
    <span class="meta-post">
  <em class="fa fa-calendar-alt"></em
  >&nbsp;Jun 22, 2023
  
  &nbsp;&nbsp;<i class="fas fa-clock"></i>&nbsp;9 min read

  
    &nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
    
      <a
        href="https://ixiaopan.github.io/blog/categories/frontend/"
        >Frontend</a
      >&nbsp;
    
  
</span>

  </div>
  
</header>

    
  <div class="container" role="main">
    <div class="inner">
      <article class="article" class="blog-post">
        
  <p>Speaking of images and videos, we often use <code>img/video</code> to preview them. However, there are more ways to do this. Today we will introduce some new preview techniques based on frames, such as frame-based video preview, drawing continuous frames over a time, and extract any frame of a gif image.</p>
<h2 id="preview-video-using-long-frames">Preview video using long frames</h2>
<p>To play a video, we usually use <code>&lt;video&gt;</code> tag. However, when we have a page containing hundreds of videos, performance may be a matter if we use <code>&lt;video&gt;</code> tag.</p>
<p>In our case, the <code>div</code> shows a cover by default. When we move the cursor on it, the <code>div</code> shows the current frame by calculating the elapsed time based on cursor&rsquo;s offset. Therefore, when we move quickly, the <code>div</code> looks like playing a video.</p>
<p>
  <img src="./long-frame.gif" alt="">
</p>
<p>How to implement this? The initial attempt is to embed a <code>&lt;video&gt;</code> tag and set the <code>currentTime</code>. Well, it seems a little heavy. Maybe we don&rsquo;t need a real <code>video</code>.</p>
<p>Instead, we use a list of frames extracted from the original video to simulate the play. For example, each frame is <code>100px*150px</code> and there are 10 frames in total, so the final image is <code>100px*1500px</code>. Wait, why do we stitch the frames vertically? Remember, the screen shows picture by scanning from the left to right and from top to bottom. If the width is too long, it will take much time to render the next line.</p>
<p>
  <img src="./long-frames.png" alt="">
</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onMouseEnter</span>() {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">disableLongPicture</span>) <span style="color:#66d9ef">return</span>
  
  <span style="color:#75715e">// download the long image only when mouse enter
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">preloadThumbnail</span>()
  
  <span style="color:#a6e22e">hasEntered</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
}
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onMouseLeave</span>() {
  <span style="color:#a6e22e">hasEntered</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
}
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onMouseMove</span>(<span style="color:#a6e22e">e</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">disableLongPicture</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">frameDone</span>.<span style="color:#a6e22e">value</span>) <span style="color:#66d9ef">return</span>

  <span style="color:#75715e">// threshold = 1      
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ratio</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">pageX</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">wrapLeft</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">wrapWidth</span>.<span style="color:#a6e22e">value</span>
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">offsetNum</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">frameCount</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, Math.<span style="color:#a6e22e">max</span>(<span style="color:#ae81ff">0</span>, Math.<span style="color:#a6e22e">ceil</span>(<span style="color:#a6e22e">ratio</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">frameCount</span>)))
  <span style="color:#a6e22e">framePositionStyle</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;background-position&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`0 </span><span style="color:#e6db74">${</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">offsetNum</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">heightPerFrame</span>.<span style="color:#a6e22e">value</span><span style="color:#e6db74">}</span><span style="color:#e6db74">px`</span>
  }
  <span style="color:#a6e22e">lineStyle</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">left</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ratio</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">wrapWidth</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>,
  }
  <span style="color:#a6e22e">currentTime</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">duration</span>.<span style="color:#a6e22e">value</span>,  Math.<span style="color:#a6e22e">max</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">ratio</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">duration</span>.<span style="color:#a6e22e">value</span>))
}
</code></pre></div><h2 id="preview-any-frame-of-a-gif">Preview any frame of a gif</h2>
<p>工作中遇到一个需求，GIF 默认显示第一帧画面，<code>hover</code> 的时候再显示 gif 本身，效果如下</p>
<p>
  <img src="./gif-test.gif" alt="">
</p>
<h3 id="how">How</h3>
<p><code>canvas.drawImage()</code> 可以提取序列帧，代码实现如下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getFirstFrameFromGif</span>(<span style="color:#a6e22e">img</span>) {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;canvas&#39;</span>)
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#39;2d&#39;</span>)  

  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">naturalWidth</span>
  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">naturalHeight</span>
  
  <span style="color:#66d9ef">try</span> {
    <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">drawImage</span>(<span style="color:#a6e22e">img</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">naturalWidth</span>, <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">naturalHeight</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">toDataURL</span>(<span style="color:#e6db74">&#39;image/png&#39;</span>, <span style="color:#ae81ff">0.75</span>)
  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span>
  }
}
</code></pre></div><h3 id="q1">Q1</h3>
<p>拿到帧画面了，就需要交替显示图片。一开始是使用 <code>opacity/display</code> ，有几个缺点</p>
<ul>
<li>
<p>显隐切换会抖动</p>
</li>
<li>
<p>底下的 <code>gif</code> 始终在播放，那么 <code>hover</code> 的时候，画面不是从头开始播放的</p>
</li>
</ul>
<p>另个方法就是直接换 <code>src</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vue" data-lang="vue">&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gif&#34;</span> <span style="color:#f92672">@mouseenter</span><span style="color:#e6db74">=&#34;toggleGif&#34;</span> <span style="color:#f92672">@mouseleave</span><span style="color:#e6db74">=&#34;toggleGif&#34;</span>&gt;
  &lt;<span style="color:#f92672">img</span> <span style="color:#f92672">:</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;gif-placeholder&#39;, innerSrc == src ? &#39;gif-real&#39; : &#39;gif-frame&#39; ]&#34;</span> <span style="color:#f92672">:src</span><span style="color:#e6db74">=&#34;innerSrc&#34;</span> /&gt;
&lt;/<span style="color:#f92672">div</span>&gt;

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">toggleGif</span>() {
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">frameSuccess</span>.<span style="color:#a6e22e">value</span>) <span style="color:#66d9ef">return</span>

  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">gifVisible</span>.<span style="color:#a6e22e">value</span>) {
    <span style="color:#a6e22e">innerSrc</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">frameSrc</span>.<span style="color:#a6e22e">value</span>
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">innerSrc</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">src</span>
  }
  <span style="color:#a6e22e">gifVisible</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">gifVisible</span>.<span style="color:#a6e22e">value</span>
}
</code></pre></div><h3 id="q2">Q2</h3>
<p>这个组件接下来要显示在一个 <code>div</code> 里而且是 <code>cover</code> 整个容器的效果，但是组件用的 <code>img</code> 标签，无法直接用 <code>background-size: cover</code>，一个方法是用 <code>js</code> 手动算，但是还有更简单的方法，指定 <code>object-fit</code></p>
<blockquote>
<p>The object-fit CSS property sets how the content of a replaced element, such as an <code>&lt;img&gt;</code> or <code>&lt;video&gt;</code>, should be resized to fit its container.
&ndash; MDN</p>
</blockquote>
<p>实现代码如下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">.<span style="color:#a6e22e">gif</span> {
  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
}
.<span style="color:#a6e22e">mogic-gif-frame</span> {
  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
  
  <span style="color:#66d9ef">object-fit</span>: <span style="color:#66d9ef">cover</span>;
}
</code></pre></div><h3 id="任意一帧">任意一帧</h3>
<p>第一帧是很简单，现在如果想要提取任意时刻的一帧呢？？说实话，几个月之前，我是真不知道的，也就是今天我才在 <a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageDecoder">MDN</a> 上看到方法，就是用 <code>ImageCoder</code> 实现，官方给的例子就可以满足我们的需求。</p>
<p>Step 1 加载图片，实例化解码器</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">decoder</span>
<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">res</span>) =&gt; {
  <span style="color:#a6e22e">decoder</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ImageDecoder</span>({
    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">body</span>,
    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;image/gif&#39;</span>,
  })
})
</code></pre></div><p>Step 2 解析指定位置的帧，渲染到 <code>canvas</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
  <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">decode</span>({
    <span style="color:#a6e22e">frameIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">n</span>,
  }).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">renderFrame</span>)
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderFrame</span>(<span style="color:#a6e22e">res</span>) {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;canvas&#39;</span>)
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">context</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#39;2d&#39;</span>)
  <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">drawImag</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">image</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>)
}
</code></pre></div><h3 id="draw-gif-on-the-canvas">Draw GIF on the canvas</h3>
<p>既然可以得到任意帧，那么把 GIF 绘制出来，也不是难事，来排个队依次渲染就好了。需要注意的是，这个依次渲染，不是 <code>0 delay</code> 的，比如 我们执行一个 <code>for loop</code>。
因为渲染1帧也是有时长的，比如我们说帧率 <code>25fps</code>，那么绘制一帧需要 <code>40ms</code>，也就是说，需要等 <code>40ms</code> 后，才能绘制第2桢。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
  <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">decode</span>({
    <span style="color:#a6e22e">frameIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">n</span>,
  }).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">renderFrame</span>)
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderFrame</span>(<span style="color:#a6e22e">res</span>) {
  <span style="color:#75715e">// render the nth frame
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;canvas&#39;</span>)
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">context</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#39;2d&#39;</span>)
  <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">drawImag</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">image</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>)

  Promise.<span style="color:#a6e22e">all</span>([
    <span style="color:#75715e">// decode the next image ahead
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">decode</span>({
      <span style="color:#a6e22e">frameIndex</span><span style="color:#f92672">:</span> <span style="color:#f92672">++</span><span style="color:#a6e22e">n</span>,
    }),
    <span style="color:#75715e">// duration for rendering the current frame
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>) =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">delay</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">duration</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>    
      <span style="color:#a6e22e">setTimeout</span>(<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">dealy</span>)
    })
  ]).<span style="color:#a6e22e">then</span>(([<span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">_</span>]) =&gt; {
    <span style="color:#a6e22e">renderFrame</span>(<span style="color:#a6e22e">res</span>)
  })
}
</code></pre></div><p>上面的代码还是有问题，<code>n</code> 会越界从而触发 <code>RangeError</code>，要想解决，需要知道这个 <code>GIF</code> 总共有多少帧</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// get the current image track
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">track</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">tracks</span>.<span style="color:#a6e22e">selectedTrack</span>

<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">complete</span>) {
  <span style="color:#75715e">// static image
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">track</span>.<span style="color:#a6e22e">frameCount</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
    <span style="color:#66d9ef">return</span>
  }

  <span style="color:#75715e">// rewind
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">n</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">track</span>.<span style="color:#a6e22e">frameCount</span>) {
    <span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
  }
}
</code></pre></div><h2 id="draw-continuous-video-frames">Draw continuous video frames</h2>
<p>We often see a series of images (e.g. the below one) shown on the track panel when we use some video editor apps.</p>
<p>
  <img src="./frame-queue.png" alt="">
</p>
<p>To achieve this, we need to solve</p>
<ul>
<li>
<p>how to draw a series of images over a period time</p>
</li>
<li>
<p>how to draw a series of images over a continuous period time</p>
</li>
<li>
<p>how images change when zoom scale changes</p>
</li>
</ul>
<h3 id="q1-extract-continuous-images">Q1 Extract continuous images</h3>
<p>Thanks to <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage">canvas.drawImage</a>, we can easily extract any frame from a video.</p>
<p>Suppose we want to extract frames every <code>250ms</code> from <code>0s</code> to <code>3s</code>,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">drawByTime</span>(<span style="color:#a6e22e">startTime</span><span style="color:#960050;background-color:#1e0010">，</span> <span style="color:#a6e22e">endTime</span>, <span style="color:#a6e22e">msPerDraw</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">250</span>) {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">frameCount</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>((<span style="color:#a6e22e">endTime</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">startTime</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">msPerDraw</span>)

  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">beginTime</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startTime</span>
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">drawFrame</span> <span style="color:#f92672">=</span> () =&gt; {
    <span style="color:#a6e22e">seekTime</span>(<span style="color:#a6e22e">beginTime</span>).<span style="color:#a6e22e">then</span>(() =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">offlineCanvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;canvas&#39;</span>)
      <span style="color:#a6e22e">offlineCanvas</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">frameWidth</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>
      <span style="color:#a6e22e">offlineCanvas</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">frameHeight</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>

      <span style="color:#a6e22e">offlineCanvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">frameWidth</span> 
      <span style="color:#a6e22e">offlineCanvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">frameHeight</span>

      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">offlineCanvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#39;2d&#39;</span>)
      <span style="color:#a6e22e">ctx</span><span style="color:#f92672">!</span>.<span style="color:#a6e22e">drawImage</span>(<span style="color:#a6e22e">video</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">frameWidth</span>, <span style="color:#a6e22e">frameHeight</span>)

      <span style="color:#a6e22e">beginTime</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">endTime</span>, <span style="color:#a6e22e">beginTime</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">msPerDraw</span>)
    })
  }
  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">count</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">totalFrames</span>; <span style="color:#a6e22e">count</span><span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">drawFrame</span>()
  }
}
<span style="color:#a6e22e">drawByTime</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3000</span>)
</code></pre></div><h3 id="q2-extract-continuous-images-over-a-continuous-period-time">Q2 Extract continuous images over a continuous period time</h3>
<p>The above solution works if we only draw frames once. What if we have multiple periods? For example, draw images between <code>0-3s</code> and <code>6-10s</code>. In this case, order matters, i.e. <code>0-3s</code> must be drawn first, and then <code>6-10s</code> is drawn. Therefore, we need a queue to control the order.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">timeList</span> <span style="color:#f92672">=</span> [ { <span style="color:#a6e22e">startTime</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">endTime</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3000</span> }, { <span style="color:#a6e22e">startTime</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">6000</span>, <span style="color:#a6e22e">endTime</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10000</span> }]
<span style="color:#a6e22e">timeList</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">val</span>) =&gt; {
  <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">drawByTime</span>(<span style="color:#a6e22e">val</span>.<span style="color:#a6e22e">startTime</span>, <span style="color:#a6e22e">val</span>.<span style="color:#a6e22e">endTime</span>)
})
</code></pre></div><h3 id="q3-how-images-change-whe-scaler-changes">Q3 How images change whe scaler changes</h3>
<p>So far so good. However, things become difficult when scaler is added. The final effect we want to achieve is shown below.</p>
<p>
  <img src="./scale-frame-queue.gif" alt="">
</p>
<p>From the gif, we can see that the frame count becomes smaller/larger when we zoom out/in. In other words, the time of drawing one frame(<code>msPerDraw</code>) become shorter as we zoom in.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onScaleChange</span>(<span style="color:#a6e22e">ratioIncrease</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span>) {
  <span style="color:#a6e22e">timeList</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">val</span>) =&gt; {
    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">drawByTime</span>(<span style="color:#a6e22e">val</span>.<span style="color:#a6e22e">startTime</span>, <span style="color:#a6e22e">val</span>.<span style="color:#a6e22e">endTime</span><span style="color:#960050;background-color:#1e0010">，</span> <span style="color:#ae81ff">250</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">ratioIncrease</span>)
  })
}
</code></pre></div><h3 id="refine">Refine</h3>
<p>Though the above code works, the performance is not good, especially when we change the scaler. Do you sport the issue? Well, the problem is that every time we zoom in/out, <code>msPerDraw</code> will change, causing the unstable currentTime of a video due to this line of code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">beginTime</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">endTime</span>, <span style="color:#a6e22e">beginTime</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">msPerDraw</span>)
</code></pre></div><p>All in all, we are drawing unstable(different) frames because of seeking different currentTime every time we zoom in/out. In fact, it&rsquo;s unnecessary since the precision is not required to be 100% in our business.</p>
<p>A better way is to cache more frames and show them selectively.</p>
<ul>
<li>
<p><code>more frames</code> means we first cache frames(say <code>MaxN</code>) based on the minimum <code>msPerDraw</code> (the maximum scaler)</p>
</li>
<li>
<p><code>show them selectively</code> means calculate the real frame count (<code>MaxN*ratio</code>) as the scaler changes. (Because <code>MaxN</code> is the largest frame count, the real frame count can only be smaller than <code>MaxN</code>.)</p>
</li>
</ul>
<p>First, we need a queue to cache all frames</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">frameList</span> <span style="color:#f92672">=</span> []

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">init</span>() {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">myFrameQueue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FrameQueue</span>()
  
  <span style="color:#a6e22e">timeList</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">val</span>) =&gt; {
    <span style="color:#a6e22e">myFrameQueue</span>.<span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">next</span>) =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">frameCount</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>((<span style="color:#a6e22e">endTime</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">startTime</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">msPerDraw</span>)
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tempList</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">HTMLCanvasElement</span>[] <span style="color:#f92672">=</span> []
      ....
      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">count</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">totalFrames</span>; <span style="color:#a6e22e">count</span><span style="color:#f92672">++</span>) {
        <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">drawFrame</span>()
      }
      <span style="color:#75715e">// cached !!!
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">frameList</span>.<span style="color:#a6e22e">push</span>({
        <span style="color:#a6e22e">canvas</span>,
        <span style="color:#a6e22e">frameWidth</span>,
        <span style="color:#a6e22e">frameHeight</span>,
        <span style="color:#a6e22e">list</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tempList</span>,
      })

      <span style="color:#a6e22e">next</span>()
    })
  })
  
  <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">myFrameQueue</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">run</span>(<span style="color:#66d9ef">null</span>, () =&gt; {
    <span style="color:#a6e22e">myFrameQueue</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">destroy</span>()
    <span style="color:#a6e22e">renderFrames</span>(<span style="color:#a6e22e">scaler</span>)
  })
}
</code></pre></div><p>To cache and draw frames(<code>frameList</code>) in order, we use a common asynchronous control flow patten called  <code>sequential execution</code> (we will talk it more in other posts) in <code>FrameQueue</code>. The core of this pattern is that the order of execution must be preserved.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FrameQueue</span> {
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">queue</span><span style="color:#f92672">:</span> Array<span style="color:#f92672">&lt;</span>Function<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> []
  
  ...
  
  <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">run</span>(<span style="color:#a6e22e">context</span><span style="color:#f92672">?:</span> <span style="color:#a6e22e">any</span>, <span style="color:#a6e22e">doneCallback</span><span style="color:#f92672">?:</span> Function) {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Promise<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">void</span><span style="color:#f92672">&gt;</span>(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">resolve</span>) =&gt; {
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">lastIndex</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>

      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">step</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">index</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span>) =&gt; {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">lastIndex</span>) {
          <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;next() called multiple times&#39;</span>)
        }

        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">queue</span>.<span style="color:#a6e22e">length</span>) {
          <span style="color:#a6e22e">resolve</span>()
          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">doneCallback</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">doneCallback</span>()
        }

        <span style="color:#a6e22e">lastIndex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">index</span>

        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fn</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">queue</span>[<span style="color:#a6e22e">index</span>]

        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">fn</span>) {
          <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fn</span>(<span style="color:#a6e22e">context</span>, () =&gt; {
            <span style="color:#a6e22e">step</span>(<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
          })
        }
      }

      <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">step</span>(<span style="color:#ae81ff">0</span>)
    })
  }
}
</code></pre></div><p>The last step is to render frames based on the current scaler. The default value is <code>0.5</code> (the min is 0 and the max is 1)</p>
<ul>
<li>
<p>calculate the real number of frames to render for each time segment</p>
</li>
<li>
<p>select the corresponding frames from <code>frameList</code></p>
</li>
<li>
<p>redraw frames on <code>canvas</code></p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderFrames</span>(<span style="color:#a6e22e">scaler</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>) {
  <span style="color:#a6e22e">frameList</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">any</span>) =&gt; {
    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">canvas</span>, <span style="color:#a6e22e">list</span>, <span style="color:#a6e22e">frameWidth</span>, <span style="color:#a6e22e">frameHeight</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">item</span>
    
    <span style="color:#75715e">// step1 the maximum number of frames to render
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">maxFrameNum</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">length</span>
    <span style="color:#75715e">// at least draw 1 frame
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// the real number of frames to render =  MaxN * ratio
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">totalFrames</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#ae81ff">1</span>, Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">maxFrameNum</span>, Math.<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">maxFrameNum</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">scaler</span>)))

    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#39;2d&#39;</span>)
    
    <span style="color:#75715e">// step2
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">step</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">maxFrameNum</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">totalFrames</span>
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">totalFrames</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span>  Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">step</span>)

      <span style="color:#75715e">// step 3
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">list</span>[<span style="color:#a6e22e">j</span>]) {
        <span style="color:#a6e22e">ctx</span><span style="color:#f92672">!</span>.<span style="color:#a6e22e">drawImage</span>(
          <span style="color:#a6e22e">list</span>[<span style="color:#a6e22e">j</span>],
          <span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">frameWidth</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">ratio</span>,
          <span style="color:#ae81ff">0</span>,
          <span style="color:#a6e22e">frameWidth</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">ratio</span>,
          <span style="color:#a6e22e">frameHeight</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">ratio</span>
        )
      }
    }
  })
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onScaleChange</span>(<span style="color:#a6e22e">nextScaler</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span>) {
  <span style="color:#a6e22e">renderFrames</span>(<span style="color:#a6e22e">nextScaler</span>)
}
</code></pre></div>



        
      </article>

      
      <aside class="article-aside">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#preview-video-using-long-frames">Preview video using long frames</a></li>
    <li><a href="#preview-any-frame-of-a-gif">Preview any frame of a gif</a>
      <ul>
        <li><a href="#how">How</a></li>
        <li><a href="#q1">Q1</a></li>
        <li><a href="#q2">Q2</a></li>
        <li><a href="#任意一帧">任意一帧</a></li>
        <li><a href="#draw-gif-on-the-canvas">Draw GIF on the canvas</a></li>
      </ul>
    </li>
    <li><a href="#draw-continuous-video-frames">Draw continuous video frames</a>
      <ul>
        <li><a href="#q1-extract-continuous-images">Q1 Extract continuous images</a></li>
        <li><a href="#q2-extract-continuous-images-over-a-continuous-period-time">Q2 Extract continuous images over a continuous period time</a></li>
        <li><a href="#q3-how-images-change-whe-scaler-changes">Q3 How images change whe scaler changes</a></li>
        <li><a href="#refine">Refine</a></li>
      </ul>
    </li>
  </ul>
</nav>
      
      </aside>
    </div>
    
    
    
    
      

    
  </div>

    <footer>
  

<div class="social-icons">
  
    
    
      
      <a href="mailto:?to=xiaopan.wpp@outlook.com" name="Email">
        <em class="fas fa-envelope"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://github.com/ixiaopan" name="GitHub">
        <em class="fab fa-github"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://www.linkedin.com/in/ixiaopan" name="Linkedin">
        <em class="fab fa-linkedin"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://space.bilibili.com/22910840" name="Bilibili">
        <em class="fab fa-youtube"></em>
      </a>
    
  

  
</div>


  
  <div class="container">
    <p class="credits copyright">
      <a href="https://ixiaopan.github.io/blog/about">ixiaopan</a>
      &nbsp;&copy;
      2023
      
      &nbsp;&ndash;&nbsp;
      <em class="fas fa-moon" id="dark-mode-toggle"></em>
    </p>

    <p class="credits theme-by">
      Powered By <a href="https://gohugo.io">Hugo</a>&nbsp;
      Theme
      <a href="https://github.com/matsuyoshi30/harbor">Harbor</a>
    </p>
  </div>
</footer>

  </body>
</html>
