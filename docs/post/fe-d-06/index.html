<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<title>D - The track panel of a video editor</title>



  
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-203640627-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-203640627-1');
  </script>
  




<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
  rel="alternate"
  type="application/rss+xml"
  href="https://ixiaopan.github.io/blog/index.xml"
  title=""
/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="D - The track panel of a video editor"/>
<meta name="twitter:description" content="In the previous post, we have learned how to design a video player. In fact, a video player is a container containing many tracks, such as bgm, text, and so on. Can we show and edit these tracks? Of course we can. But today, we will focus on the UI part. For the edit operation, we will talk it later."/>




<link rel="stylesheet" href="https://ixiaopan.github.io/blog/fontawesome/css/all.min.css" />




<link
  crossorigin="anonymous"
  href="/blog/css/styles.min.css"
  integrity=""
  rel="preload stylesheet"
  as="style"
/>


  <link rel="stylesheet" href="https://ixiaopan.github.io/blog/css/main.css" />



<link
  id="dark-mode-theme"
  crossorigin="anonymous"
  href="/blog/css/dark.min.css"
  integrity=""
  rel="preload stylesheet"
  as="style"
/>


<script>
  var darkTheme = document.getElementById('dark-mode-theme')
  var storedTheme = localStorage.getItem('dark-mode-storage')
  if (storedTheme === 'dark') {
    darkTheme.disabled = false
  } else if (storedTheme === 'light') {
    darkTheme.disabled = true
  }
</script>



<script defer crossorigin="anonymous" src="/blog/js/theme.js" integrity=""></script>

<script src="https://ixiaopan.github.io/blog/js/instantpage.min.js" type="module" defer></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css" integrity="sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.js" integrity="sha384-JiKN5O8x9Hhs/UE5cT5AAJqieYlOZbGT3CHws/y97o3ty4R7/O5poG9F3JoiOYw1" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>

 



<meta name="generator" content="Hugo 0.91.0" />
  </head>
  <body>
    
  




<header>
  <nav class="navbar">
  <div class="nav">
    
      <a href="https://ixiaopan.github.io/blog/" class="nav-logo">
        <img
          src="https://ixiaopan.github.io/blog/images/me.JPG"
          width="50"
          height="50"
          alt="Logo"
        />
      </a>
    

    <ul class="nav-links">
      
        
          <li>
            <a href="/blog/search" id="Search"
              ><em class="fas fa-search fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/blog/about" id="About"
              ><em class="fas fa-user fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/blog/categories" id="Category"
              ><em class="fas fa-folder-open fa-lg"></em
            ></a>
          </li>
          
      
    </ul>
  </div>
</nav>


  
  <div class="intro-header">
    <h1 class="post-heading">
      D - The track panel of a video editor
    </h1>
    <span class="meta-post">
  <em class="fa fa-calendar-alt"></em
  >&nbsp;Jun 26, 2023
  
  &nbsp;&nbsp;<i class="fas fa-clock"></i>&nbsp;5 min read

  
    &nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
    
      <a
        href="https://ixiaopan.github.io/blog/categories/frontend/"
        >Frontend</a
      >&nbsp;
    
  
</span>

  </div>
  
</header>

    
  <div class="container" role="main">
    <div class="inner">
      <article class="article" class="blog-post">
        
  <p>In the previous post, we have learned how to design a video player. In fact, a video player is a container containing many tracks, such as bgm, text, and so on. Can we show and edit these tracks? Of course we can. But today, we will focus on the <code>UI</code> part. For the edit operation, we will talk it later.</p>
<h2 id="comps">Comps</h2>
<p>
  <img src="./track-panel.png" alt="">
</p>
<p>From the above image, we can see that the track panel has three main parts:</p>
<ul>
<li>
<p>timeline(scale + indicator)</p>
<ul>
<li>the container for both zoom and track</li>
<li>the initial reference is called <code>baseWidth</code>, which means how many pixels 1 second hold</li>
<li>When zoom in, <code>baseWidth</code> becomes larger; When zoom out, <code>baseWidth</code> becomes smaller</li>
</ul>
</li>
<li>
<p>zoom</p>
<ul>
<li>zoom-in and zoom-out, which affects the width of the timeline and the track</li>
</ul>
</li>
<li>
<p>track</p>
<ul>
<li>
<p>several types, e.g. <code>bgm/text/tts...</code></p>
</li>
<li>
<p>each track type can have many segments, and segments can overlap. If so, we move down the last segment like down staircases. We use <code>yIndex</code> indicates the index of the segment along the <code>y</code> axis in the same track type. Usually, <code>yIndex</code> is <code>0</code>.</p>
</li>
<li>
<p>each track has its start position defined by offsetX(<code>startTime * baseWidth</code>) and offsetY(<code>yIndex*trackHeight</code>) as well as width decided by <code>duration</code> and <code>baseWidth</code>.</p>
</li>
</ul>
</li>
</ul>
<h2 id="track">Track</h2>
<p>First, different track type has different styles, so we need to define each track type first.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">TRACK_TYPE</span> {
  <span style="color:#a6e22e">BGM</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
  <span style="color:#a6e22e">TEXT</span>,
  <span style="color:#a6e22e">TTS</span>,
  <span style="color:#a6e22e">SUBTITLE</span>,
  <span style="color:#a6e22e">VIDEO</span>,
  <span style="color:#a6e22e">CLIP</span>,
}
</code></pre></div><p>Second, each track has its position and width, which is determined by the start time, duration, yIndex and the baseWidth.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">duration</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">baseWidth</span>

<span style="color:#a6e22e">offsetX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startTime</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">baseWidth</span>

<span style="color:#a6e22e">offsetY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">yIndex</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">someHeight</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vue" data-lang="vue">&lt;<span style="color:#f92672">template</span>&gt;
  &lt;<span style="color:#f92672">div</span> <span style="color:#f92672">:</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;track&#39;, &#39;track-&#39; + type]&#34;</span> <span style="color:#f92672">:style</span><span style="color:#e6db74">=&#34;styleObj&#34;</span> <span style="color:#f92672">:data-scale</span><span style="color:#e6db74">=&#34;baseWidth&#34;</span> <span style="color:#f92672">:data-start</span><span style="color:#e6db74">=&#34;startTime&#34;</span> <span style="color:#f92672">:data-duration</span><span style="color:#e6db74">=&#34;duration&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#f92672">:class</span><span style="color:#e6db74">=&#34;[&#39;track-inner&#39;]&#34;</span>&gt;
      &lt;<span style="color:#f92672">icon</span> /&gt;
      &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;track-text&#34;</span>&gt;&lt;<span style="color:#f92672">slot</span> /&gt;&lt;/<span style="color:#f92672">span</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
  &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">template</span>&gt;

&lt;<span style="color:#f92672">script</span>&gt;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">styleObj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">computed</span>(() =&gt; {
  <span style="color:#66d9ef">return</span> {
    <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">baseWidth</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">duration</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>,
    <span style="color:#a6e22e">transform</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;translate(&#39;</span> <span style="color:#f92672">+</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">baseWidth</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">startTime</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px,&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">yIndex</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">yOffset</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px)&#39;</span>,
  }
})
&lt;/<span style="color:#f92672">script</span>&gt;

&lt;<span style="color:#f92672">style</span>&gt;
.<span style="color:#a6e22e">track</span><span style="color:#f92672">-</span><span style="color:#a6e22e">bgm</span> {
  <span style="color:#f92672">&amp;:</span><span style="color:#a6e22e">hover</span> .<span style="color:#a6e22e">track</span><span style="color:#f92672">-</span><span style="color:#a6e22e">inner</span> {
    <span style="color:#a6e22e">outline</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span><span style="color:#a6e22e">px</span> <span style="color:#a6e22e">solid</span> <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">f00</span>;
    <span style="color:#a6e22e">outline</span><span style="color:#f92672">-</span><span style="color:#a6e22e">offset</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#a6e22e">px</span>;
  }
  <span style="color:#f92672">&amp;:</span><span style="color:#a6e22e">active</span> .<span style="color:#a6e22e">track</span><span style="color:#f92672">-</span><span style="color:#a6e22e">inner</span>,
  <span style="color:#f92672">&amp;</span>.<span style="color:#a6e22e">active</span> .<span style="color:#a6e22e">track</span><span style="color:#f92672">-</span><span style="color:#a6e22e">inner</span> {
    <span style="color:#a6e22e">outline</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span><span style="color:#a6e22e">px</span> <span style="color:#a6e22e">solid</span> <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">f00</span>;
    <span style="color:#a6e22e">outline</span><span style="color:#f92672">-</span><span style="color:#a6e22e">offset</span><span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#a6e22e">px</span>;
  }
}
&lt;/<span style="color:#f92672">style</span>&gt;
</code></pre></div><p>The interesting thing here is the use of <code>outline</code> instead of <code>border</code>. The reason is that the segment width in hover status is <code>1px</code> while it&rsquo;s <code>2px</code> in active status. If we use <code>border</code>, the whole segment will shake slightly when we hover and click it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">&lt;</span><span style="color:#f92672">style</span><span style="color:#f92672">&gt;</span>
.<span style="color:#a6e22e">track-bgm</span> {
  <span style="color:#960050;background-color:#1e0010">&amp;:hover</span> <span style="color:#960050;background-color:#1e0010">.track-inner</span> <span style="color:#960050;background-color:#1e0010">{</span>
    <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#f00</span>;
  }
  <span style="color:#f92672">&amp;</span>:<span style="color:#a6e22e">active</span> .<span style="color:#a6e22e">track-inner</span><span style="color:#f92672">,</span>
  <span style="color:#f92672">&amp;</span>.<span style="color:#a6e22e">active</span> .<span style="color:#a6e22e">track-inner</span> {
    <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#f00</span>;
  }
<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#f92672">&lt;/</span><span style="color:#f92672">style</span><span style="color:#f92672">&gt;</span>
</code></pre></div><p>The reason is that <code>border</code> takes up space. Luckily, <code>outline</code> can do this.</p>
<blockquote>
<p>Unlike other areas of the box, outlines don&rsquo;t take up space, so they don&rsquo;t affect the layout of the document in any way - MDN</p>
</blockquote>
<p>Besides <code>outline</code>, we can also use <code>border + box-shadow</code> to achieve the same effect.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">&lt;</span><span style="color:#f92672">style</span><span style="color:#f92672">&gt;</span>
.<span style="color:#a6e22e">track-bgm</span> {
  <span style="color:#960050;background-color:#1e0010">.track-inner</span> <span style="color:#960050;background-color:#1e0010">{</span>
    <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#66d9ef">transparent</span>;
  }
  <span style="color:#f92672">&amp;</span>:<span style="color:#a6e22e">hover</span> .<span style="color:#a6e22e">track-inner</span> {
    <span style="color:#66d9ef">border-color</span>: <span style="color:#ae81ff">#f00</span>;
  }
  <span style="color:#f92672">&amp;</span>:<span style="color:#a6e22e">active</span> .<span style="color:#a6e22e">track-inner</span><span style="color:#f92672">,</span>
  <span style="color:#f92672">&amp;</span>.<span style="color:#a6e22e">active</span> .<span style="color:#a6e22e">track-inner</span> {
    <span style="color:#66d9ef">border-color</span>: <span style="color:#ae81ff">#f00</span>;
    <span style="color:#66d9ef">box-shadow</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">#f00</span>;
  }
<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#f92672">&lt;/</span><span style="color:#f92672">style</span><span style="color:#f92672">&gt;</span>
</code></pre></div><h2 id="zoom">Zoom</h2>
<p>This component is simple enough. All we care about is the scale value.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onZoomOut</span>() {
  <span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;change&#39;</span>, Math.<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">min</span>, <span style="color:#a6e22e">scaleVal</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">step</span>) <span style="color:#f92672">/</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">max</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">min</span>))
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onZoomIn</span>() {
  <span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;change&#39;</span>, Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">max</span>, <span style="color:#a6e22e">scaleVal</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">step</span>) <span style="color:#f92672">/</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">max</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">min</span>))
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onChange</span>(<span style="color:#a6e22e">val</span>) {
  <span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;change&#39;</span>, <span style="color:#a6e22e">val</span> <span style="color:#f92672">/</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">max</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">min</span>))
}
</code></pre></div><h2 id="timeline">Timeline</h2>
<p><code>timeline</code> is a little difficult. First, the whole timeline need to be scalable by the zoom scale. Second, we can seek at any position of it.</p>
<h3 id="ruler">Ruler</h3>
<p>There are 2 things about ruler</p>
<ul>
<li>
<p>suppose there are <code>n</code> seconds in total, the total duration in the ruler should be greater than <code>n</code> since we need some room in a ruler</p>
</li>
<li>
<p>ruler should divided equally: the major scale is <code>s</code>, and the minor scale is <code>ms</code></p>
</li>
</ul>
<p>Based on the above two principles, we can write code like this</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vue" data-lang="vue">&lt;<span style="color:#f92672">template</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;timeline-ruler-wrap&#34;</span>&gt;
  &lt;<span style="color:#f92672">a-seek</span> <span style="color:#f92672">@seek</span><span style="color:#e6db74">=&#34;onSeek&#34;</span> <span style="color:#a6e22e">scrollable</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;timeline-ruler&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;timeline-major&#34;</span> <span style="color:#f92672">v-for</span><span style="color:#e6db74">=&#34;m in realMax - min&#34;&gt;
</span><span style="color:#e6db74">      &lt;span class=&#34;timeline-major-text&#34;&gt;{{ min + m - 1 }}s&lt;/span&gt;
</span><span style="color:#e6db74">      &lt;span class=&#34;timeline-minor&#34; v-for=&#34;n in step&#34;&gt;&lt;/span&gt;
</span><span style="color:#e6db74">    &lt;/div&gt;
</span><span style="color:#e6db74">  &lt;/a-seek&gt;
</span><span style="color:#e6db74">&lt;/div&gt;
</span><span style="color:#e6db74">&lt;/template&gt;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">&lt;style lang=&#34;less&#34;</span>&gt;
<span style="color:#a6e22e">.timeline</span><span style="color:#f92672">-ruler</span> {
  <span style="color:#a6e22e">display</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">flex</span><span style="color:#960050;background-color:#1e0010">;</span>
  <span style="color:#a6e22e">.timeline</span><span style="color:#f92672">-major</span> {
    <span style="color:#a6e22e">flex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">1</span><span style="color:#960050;background-color:#1e0010">;</span>
    <span style="color:#a6e22e">display</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">flex</span><span style="color:#960050;background-color:#1e0010">;</span>
    <span style="color:#a6e22e">justify</span><span style="color:#f92672">-content</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">space</span><span style="color:#f92672">-between</span><span style="color:#960050;background-color:#1e0010">;</span>
  }
  <span style="color:#a6e22e">.timeline</span><span style="color:#f92672">-minor</span> {
    <span style="color:#a6e22e">flex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">1</span><span style="color:#960050;background-color:#1e0010">;</span>
  }
}
&lt;/<span style="color:#f92672">style</span>&gt;

&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ts&#34;</span> <span style="color:#a6e22e">setup</span>&gt;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">realMax</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">computed</span>(() =&gt; <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">max</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">threshold</span>)
&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><h3 id="auto-resized">Auto-Resized</h3>
<p>As mentioned earlier, we define a param called <code>baseWidth</code>, which means the width per second(e.g. <code>80px/1000ms</code>) or the width of a major scale. Thus, we can set the whole timeline in this way</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vue" data-lang="vue">
&lt;<span style="color:#f92672">template</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;timeline-ruler-wrap&#34;</span> <span style="color:#f92672">:style</span><span style="color:#e6db74">=&#34;wrapStyle&#34;</span> <span style="color:#a6e22e">ref</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;scrollRef&#34;</span>&gt;
  &lt;<span style="color:#f92672">a-seek</span> <span style="color:#f92672">@seek</span><span style="color:#e6db74">=&#34;onSeek&#34;</span> <span style="color:#a6e22e">scrollable</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;timeline-ruler&#34;</span>&gt;...<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/a-seek&gt;</span>
&lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">template</span>&gt;

&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ts&#34;</span> <span style="color:#a6e22e">setup</span>&gt;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrapStyle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">computed</span>(() =&gt; ({
  <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">baseWidth</span> <span style="color:#f92672">*</span> (<span style="color:#a6e22e">realMax</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">min</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;px&#39;</span>,
}))
&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><p>As the zoom changes, we can get the scaled value from the <code>change</code> event, and then we simply change the <code>baseWidth</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vue" data-lang="vue">&lt;<span style="color:#f92672">template</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;editor-track-panel&#34;</span>&gt;
  &lt;<span style="color:#f92672">a-zoom</span> <span style="color:#f92672">@change</span><span style="color:#e6db74">=&#34;onZoomChange&#34;</span> /&gt;
  &lt;<span style="color:#f92672">a-timeline</span> <span style="color:#f92672">:baseWidth</span><span style="color:#e6db74">=&#34;baseWidth&#34;</span> /&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">template</span>&gt;

&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ts&#34;</span> <span style="color:#a6e22e">setup</span>&gt;
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onZoomChange</span>(<span style="color:#a6e22e">changedRatio</span>) {
  <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">baseWidth</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">defaultBaseWidth</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">changedRatio</span>
}
&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><h3 id="seek">seek</h3>
<p>Last, we need to seek any position of the timeline. It&rsquo;s easy to get the click position, however, there two issues</p>
<ul>
<li>
<p>the ratio of the click position relative to the timeline is not exactly the ratio of the currentTime relative to the video duration. Why? Because the timeline has some extra room for UI experience. In other words, the video is <code>N</code> seconds, but the timeline is <code>N+m</code> seconds.</p>
</li>
<li>
<p>the timeline can scroll in the horizontal direction</p>
</li>
</ul>
<p>To have the exact click position, we use <code>clientX</code> instead of <code>offsetX</code>. <code>offsetX</code> can be used in simple cases, for example, a pure div container. But in our case, <code>major-scale</code> and <code>minor-scale</code> are set <code>position: relative/absolute</code>, thus, <code>offsetX</code> is unstable because the minor-scale is relative major-scale. On the contrary, <code>clientX</code> will always be the position we click.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vue" data-lang="vue">&lt;<span style="color:#f92672">div</span> <span style="color:#f92672">@click</span><span style="color:#e6db74">=&#34;onClick&#34;</span> <span style="color:#a6e22e">ref</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;seekRef&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;

&lt;<span style="color:#f92672">script</span>&gt;
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onClick</span>(<span style="color:#a6e22e">e</span>) {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ratio</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">scrollable</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">clientX</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">offsetX</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">seekWidth</span>
  <span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;seek&#39;</span>, <span style="color:#a6e22e">ratio</span>, <span style="color:#a6e22e">seekWidth</span>)
}
<span style="color:#a6e22e">onMounted</span>(() =&gt; {
  <span style="color:#a6e22e">seekWidth</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">seekRef</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">clientWidth</span>
})
&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><p>However, <code>clientX</code> is not sufficient because the timeline can scroll, so we need to calculate both the <code>scrollLeft</code> and <code>clientX</code> of the timeline. The formula is</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">realPosition</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ratio</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">seekWidth</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">clientXOfTimeline</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">scrollLeftOfTimeline</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vue" data-lang="vue">&lt;<span style="color:#f92672">template</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;editor-track-panel&#34;</span>&gt;
  &lt;<span style="color:#f92672">a-zoom</span> <span style="color:#f92672">@change</span><span style="color:#e6db74">=&#34;onZoomChange&#34;</span> /&gt;
  &lt;<span style="color:#f92672">a-timeline</span> <span style="color:#f92672">:baseWidth</span><span style="color:#e6db74">=&#34;baseWidth&#34;</span> <span style="color:#f92672">@seek</span><span style="color:#e6db74">=&#34;oSeek&#34;</span> /&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">template</span>&gt;

&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ts&#34;</span> <span style="color:#a6e22e">setup</span>&gt;
<span style="color:#75715e">// seekRealPos = progress * totalW - getElementViewOffset(timelineRef.value).left + timelineRef.value.scrollLeft
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onSeek</span>(<span style="color:#a6e22e">seekRealPos</span>) {
  <span style="color:#75715e">// duration is measured by `second`
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">seekPercent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">seekRealPos</span> <span style="color:#f92672">/</span> (<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">baseWidth</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">duration</span>) 
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">currentTime</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">seekPercent</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">duration</span>
}
&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><h2 id="refer">Refer</h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/outline">outline MDN</a></li>
</ul>



        
      </article>

      
      <aside class="article-aside">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#comps">Comps</a></li>
    <li><a href="#track">Track</a></li>
    <li><a href="#zoom">Zoom</a></li>
    <li><a href="#timeline">Timeline</a>
      <ul>
        <li><a href="#ruler">Ruler</a></li>
        <li><a href="#auto-resized">Auto-Resized</a></li>
        <li><a href="#seek">seek</a></li>
      </ul>
    </li>
    <li><a href="#refer">Refer</a></li>
  </ul>
</nav>
      
      </aside>
    </div>
    
    
    
    
      

    
  </div>

    <footer>
  

<div class="social-icons">
  
    
    
      
      <a href="mailto:?to=xiaopan.wpp@outlook.com" name="Email">
        <em class="fas fa-envelope"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://github.com/ixiaopan" name="GitHub">
        <em class="fab fa-github"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://www.linkedin.com/in/ixiaopan" name="Linkedin">
        <em class="fab fa-linkedin"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://space.bilibili.com/22910840" name="Bilibili">
        <em class="fab fa-youtube"></em>
      </a>
    
  

  
</div>


  
  <div class="container">
    <p class="credits copyright">
      <a href="https://ixiaopan.github.io/blog/about">ixiaopan</a>
      &nbsp;&copy;
      2023
      
      &nbsp;&ndash;&nbsp;
      <em class="fas fa-moon" id="dark-mode-toggle"></em>
    </p>

    <p class="credits theme-by">
      Powered By <a href="https://gohugo.io">Hugo</a>&nbsp;
      Theme
      <a href="https://github.com/matsuyoshi30/harbor">Harbor</a>
    </p>
  </div>
</footer>

  </body>
</html>
