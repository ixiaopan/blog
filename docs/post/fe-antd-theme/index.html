<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<title>Replace antd theme</title>



  
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-203640627-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-203640627-1');
  </script>
  




<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
  rel="alternate"
  type="application/rss+xml"
  href="https://ixiaopan.github.io/blog/index.xml"
  title=""
/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Replace antd theme"/>
<meta name="twitter:description" content="没有整啥插件，使用 less variable 覆盖即可"/>




<link rel="stylesheet" href="https://ixiaopan.github.io/blog/fontawesome/css/all.min.css" />




<link
  crossorigin="anonymous"
  href="/blog/css/styles.min.css"
  integrity=""
  rel="preload stylesheet"
  as="style"
/>


  <link rel="stylesheet" href="https://ixiaopan.github.io/blog/css/main.css" />



<link
  id="dark-mode-theme"
  crossorigin="anonymous"
  href="/blog/css/dark.min.css"
  integrity=""
  rel="preload stylesheet"
  as="style"
/>


<script>
  var darkTheme = document.getElementById('dark-mode-theme')
  var storedTheme = localStorage.getItem('dark-mode-storage')
  if (storedTheme === 'dark') {
    darkTheme.disabled = false
  } else if (storedTheme === 'light') {
    darkTheme.disabled = true
  }
</script>



<script defer crossorigin="anonymous" src="/blog/js/theme.js" integrity=""></script>

<script src="https://ixiaopan.github.io/blog/js/instantpage.min.js" type="module" defer></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css" integrity="sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.js" integrity="sha384-JiKN5O8x9Hhs/UE5cT5AAJqieYlOZbGT3CHws/y97o3ty4R7/O5poG9F3JoiOYw1" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>

 



<meta name="generator" content="Hugo 0.81.0" />
  </head>
  <body>
    
  




<header>
  <nav class="navbar">
  <div class="nav">
    
      <a href="https://ixiaopan.github.io/blog/" class="nav-logo">
        <img
          src="https://ixiaopan.github.io/blog/images/me.JPG"
          width="50"
          height="50"
          alt="Logo"
        />
      </a>
    

    <ul class="nav-links">
      
        
          <li>
            <a href="/blog/search" id="Search"
              ><em class="fas fa-search fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/blog/about" id="About"
              ><em class="fas fa-user fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/blog/categories" id="Category"
              ><em class="fas fa-folder-open fa-lg"></em
            ></a>
          </li>
          
      
    </ul>
  </div>
</nav>


  
  <div class="intro-header">
    <h1 class="post-heading">
      Replace antd theme
    </h1>
    <span class="meta-post">
  <em class="fa fa-calendar-alt"></em
  >&nbsp;May 29, 2022
  
  &nbsp;&nbsp;<i class="fas fa-clock"></i>&nbsp;4 min read

  
    &nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
    
      <a
        href="https://ixiaopan.github.io/blog/categories/frontend/"
        >Frontend</a
      >&nbsp;
    
  
</span>

  </div>
  
</header>

    
  <div class="container" role="main">
    <div class="inner">
      <article class="article" class="blog-post">
        
  <p>没有整啥插件，使用 <code>less variable</code> 覆盖即可</p>
<h2 id="background">Background</h2>
<p>现在大多数中后台开发都是基于第三方UI(如 antd, element-ui)，通常业务也会要求自己的主题定制，这就涉及到所谓的 <code>换肤</code>。</p>
<p>庆幸的是，这些 <code>UI</code> 提供了这样的功能，拿 <code>antd</code> 来说，<a href="https://github.com/vueComponent/ant-design-vue/blob/98755f332c3c77dea29a0dfcb54615abf4c2ec45/components/style/themes/default.less">themes/default.less</a> 包含了其使用的全部颜色变量，业务只需要覆盖即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">//</span> <span style="color:#f92672">--------</span> <span style="color:#f92672">Colors</span> <span style="color:#f92672">-----------</span>
@<span style="color:#66d9ef">primary-color</span><span style="color:#f92672">:</span> @<span style="color:#66d9ef">blue-6</span>;

<span style="color:#f92672">//</span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">Warning</span>
@<span style="color:#66d9ef">warning-color</span><span style="color:#f92672">:</span> @<span style="color:#66d9ef">gold-6</span>;
</code></pre></div><h2 id="why">Why</h2>
<p>颜色定制的原理，其实是 <code>less</code> 提供了对 <code>less variables</code> 的修改，参考 <a href="https://lesscss.org/usage/#using-less-in-the-browser-modify-variables">文档</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">less</span>.<span style="color:#a6e22e">modifyVars</span>({
  <span style="color:#e6db74">&#39;@buttonFace&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#5B83AD&#39;</span>,
  <span style="color:#e6db74">&#39;@buttonText&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#D9EEF2&#39;</span>
});
</code></pre></div><p>所以只需要在构建里加一个自动 <code>modifyVars</code>，注入对应的变量即可</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">css</span><span style="color:#f92672">:</span> {
  <span style="color:#a6e22e">preprocessorOptions</span><span style="color:#f92672">:</span> {
    <span style="color:#a6e22e">less</span><span style="color:#f92672">:</span> {
      <span style="color:#a6e22e">modifyVars</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">generateModifyVars</span>(),
      <span style="color:#a6e22e">javascriptEnabled</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
    },
  },
},

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generateModifyVars</span>() {
  <span style="color:#66d9ef">return</span> {
    <span style="color:#a6e22e">hack</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;; @import (reference) ./src/styles/theme.less&#39;</span>
  }
}
</code></pre></div><p>这是我在网上找到的大多数版本，看到这几行代码，我有几个疑惑</p>
<ul>
<li>
<p><code>javascriptEnabled</code> 干啥的</p>
</li>
<li>
<p>除了 <code>modifyVars</code> 还有其他参数吗</p>
</li>
<li>
<p><code>hack</code> 干啥的</p>
</li>
<li>
<p><code>@import (reference)</code> 和 <code>@import</code> 有什么区别</p>
</li>
</ul>
<h3 id="q1-javascriptenabled">Q1 javascriptEnabled</h3>
<p>开启这个即允许 <code>code injection</code>，但是</p>
<blockquote>
<p>False by default starting in v3.0.0. Enables evaluation of JavaScript inline in .less files. This created a security problem for some developers who didn&rsquo;t expect user input for style sheets to have executable code.</p>
</blockquote>
<p>理论上来说，修改 <code>less variable</code> 不需要这个参数，但是因为我们依赖的是 <code>antd</code> ，这个 <code>UI</code> 定义了一个基于 <code>less</code> 变量的调色板，这里有一堆 <code>js function</code>，比如</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">.<span style="color:#a6e22e">colorPaletteMixin</span>() {
<span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">functions</span><span style="color:#f92672">:</span> <span style="color:#f92672">~</span><span style="color:#e6db74">`(function() {
</span><span style="color:#e6db74">  var getHue = function(hsv, i, isLight) {
</span><span style="color:#e6db74">  };
</span><span style="color:#e6db74">}
</span></code></pre></div><p>这就导致我们不得不开启这个选项</p>
<h3 id="q2-modifyvars">Q2 modifyVars</h3>
<p>还有 <code>globalVars</code> ，区别就是一个是在文件头部，一个在文件最后注入。当然，如果你在文件头部注入，业务恰好有同名变量，也是会被覆盖，这个要注意，所以我们采用 <code>modifyVars</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lessc --global-var<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;color1=red&#34;</span>	<span style="color:#f92672">{</span> globalVars: <span style="color:#f92672">{</span> color1: <span style="color:#e6db74">&#39;red&#39;</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span>

lessc --modify-var<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;color1=red&#34;</span>	<span style="color:#f92672">{</span> modifyVars: <span style="color:#f92672">{</span> color1: <span style="color:#e6db74">&#39;red&#39;</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span>
</code></pre></div><p>除了这两个，我们还可以注入 <code>banner</code>，看一下<a href="https://github.com/less/less.js/blob/v4.1.2/packages/less/src/less/parser/parser.js#L159">源码</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">parse</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">str</span>, <span style="color:#a6e22e">callback</span>, <span style="color:#a6e22e">additionalData</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">globalVars</span>;
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">modifyVars</span>;
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">preText</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;

  <span style="color:#a6e22e">globalVars</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">additionalData</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">additionalData</span>.<span style="color:#a6e22e">globalVars</span>) <span style="color:#f92672">?</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">Parser</span>.<span style="color:#a6e22e">serializeVars</span>(<span style="color:#a6e22e">additionalData</span>.<span style="color:#a6e22e">globalVars</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">\n`</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>;
  <span style="color:#a6e22e">modifyVars</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">additionalData</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">additionalData</span>.<span style="color:#a6e22e">modifyVars</span>) <span style="color:#f92672">?</span> <span style="color:#e6db74">`\n</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">Parser</span>.<span style="color:#a6e22e">serializeVars</span>(<span style="color:#a6e22e">additionalData</span>.<span style="color:#a6e22e">modifyVars</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>;

  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">globalVars</span> <span style="color:#f92672">||</span> (<span style="color:#a6e22e">additionalData</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">additionalData</span>.<span style="color:#a6e22e">banner</span>)) {
    <span style="color:#a6e22e">preText</span> <span style="color:#f92672">=</span> ((<span style="color:#a6e22e">additionalData</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">additionalData</span>.<span style="color:#a6e22e">banner</span>) <span style="color:#f92672">?</span> <span style="color:#a6e22e">additionalData</span>.<span style="color:#a6e22e">banner</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">globalVars</span>;
  }
}
</code></pre></div><h3 id="q3-hack">Q3 hack</h3>
<p>这个其实你可以用任意的名字，不信看 <a href="https://github.com/less/less.js/blob/7491578403a5a35464772c730854c3a5169c0de7/packages/less/src/less/parser/parser.js#L2427">源码实现</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">Parser</span>.<span style="color:#a6e22e">serializeVars</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vars</span> =&gt; {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;

  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">name</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">vars</span>) {
    <span style="color:#66d9ef">if</span> (Object.<span style="color:#a6e22e">hasOwnProperty</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">vars</span>, <span style="color:#a6e22e">name</span>)) {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vars</span>[<span style="color:#a6e22e">name</span>];
      <span style="color:#a6e22e">s</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span>((<span style="color:#a6e22e">name</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;@&#39;</span>) <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;@&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">value</span><span style="color:#e6db74">}${</span>(String(<span style="color:#a6e22e">value</span>).<span style="color:#a6e22e">slice</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;;&#39;</span>) <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;;&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
    }
  }

  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span>;
};
</code></pre></div><p>所以，</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">{ 
  <span style="color:#a6e22e">hack</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;; @import (reference) ./src/styles/theme.less;&#39;</span>
}
</code></pre></div><p>最终会变成 <code>@hack: ; @import (reference) ./src/styles/theme.less';</code></p>
<h3 id="q4-import-reference">Q4 @import (reference)</h3>
<p>为啥不是 <code>@import</code> 呢？？看下 <a href="https://lesscss.org/features/#import-atrules-feature-reference">官方文档</a> 怎么说的？</p>
<blockquote>
<p>Imagine that reference marks every at-rule and selector with a reference flag in the imported file, imports as normal, but when the CSS is generated, &ldquo;reference&rdquo; selectors (as well as any media queries containing only reference selectors) are not output. reference styles will not show up in your generated CSS unless the reference styles are used as mixins or extended.</p>
</blockquote>
<p>这种方式可以按需引入，打包的时候，只会编译业务用到的一些变量、类等。</p>



        
      </article>

      
      <aside class="article-aside">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#why">Why</a>
      <ul>
        <li><a href="#q1-javascriptenabled">Q1 javascriptEnabled</a></li>
        <li><a href="#q2-modifyvars">Q2 modifyVars</a></li>
        <li><a href="#q3-hack">Q3 hack</a></li>
        <li><a href="#q4-import-reference">Q4 @import (reference)</a></li>
      </ul>
    </li>
  </ul>
</nav>
      
      </aside>
    </div>
    
    
    
    
      

    
  </div>

    <footer>
  

<div class="social-icons">
  
    
    
      
      <a href="mailto:?to=xiaopan.wpp@outlook.com" name="Email">
        <em class="fas fa-envelope"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://github.com/ixiaopan" name="GitHub">
        <em class="fab fa-github"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://www.linkedin.com/in/ixiaopan" name="Linkedin">
        <em class="fab fa-linkedin"></em>
      </a>
    
       &nbsp;&nbsp;&nbsp;
      <a href="https://space.bilibili.com/22910840" name="Bilibili">
        <em class="fab fa-youtube"></em>
      </a>
    
  

  
</div>


  
  <div class="container">
    <p class="credits copyright">
      <a href="https://ixiaopan.github.io/blog/about">ixiaopan</a>
      &nbsp;&copy;
      2023
      
      &nbsp;&ndash;&nbsp;
      <em class="fas fa-moon" id="dark-mode-toggle"></em>
    </p>

    <p class="credits theme-by">
      Powered By <a href="https://gohugo.io">Hugo</a>&nbsp;
      Theme
      <a href="https://github.com/matsuyoshi30/harbor">Harbor</a>
    </p>
  </div>
</footer>

  </body>
</html>
